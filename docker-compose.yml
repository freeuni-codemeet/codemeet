version: '3.3'
services:
  openvidu:
    ports:
      - '${OPENVIDU_EXTERNAL_PORT}:${OPENVIDU_INTERNAL_PORT}'
    image: 'openvidu/openvidu-dev:2.28.0'
    env_file:
      - ./openvidu.env

  rustpad:
    image: ekzhang/rustpad
    ports:
      - '${RUSTPAD_EXTERNAL_PORT}:${RUSTPAD_INTERNAL_PORT}'
    env_file:
      - ./rustpad.env

  core:
    build:
      context: .
      dockerfile: Dockerfile.core
    command: uvicorn backend.src.app.app:app --host ${CORE_HOST} --port ${CORE_INTERNAL_PORT}
    ports:
      - '${CORE_EXTERNAL_PORT}:${CORE_INTERNAL_PORT}'
    links:
      - "openvidu:openvidu"
    env_file:
      - core.env

  webapp:
    build:
      context: .
      dockerfile: Dockerfile.webapp
    ports:
      - '80:80'
      - '443:443'
    env_file:
      - ./webapp.env

  codemeet_db:
    image: "postgres:14"
    ports:
      - "5432:5432"
    env_file:
      - postgres.env
    volumes:
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql:ro

